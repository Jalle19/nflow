<div class="row">
  <h2>{{definition.type}} ({{workflow.id}})</h2>
</div>
<div class="row">
  <div class="col-md-6">
    <blockquote ng-show="definition.description">{{definition.description}}</blockquote>
    <ul class="listing">
      <li><a href="#/workflow-definition/{{workflow.type}}">Go to workflow definition</a></li>
    </ul>
    Created: <strong title="{{workflow.created | date:'medium' }}">{{workflow.created | fromNow}}</strong><br/>
    Current state: <strong ng-click="selectAction(workflow.state)">{{workflow.state}}</strong>
    <span ng-show="workflow.stateText">({{workflow.stateText}})</span>
    since <strong title="{{currentStateTime() | date:'medium' }}">{{currentStateTime() | fromNowOrNever}}</strong><br/>
    Next activation: <strong title={{workflow.nextActivation}}>{{workflow.nextActivation | fromNowOrNever}}</strong>
    <div>Workflow id:<strong>{{workflow.id}}</strong></div>
    <div ng-show="workflow.businessKey">Business key: <code>{{workflow.businessKey}}</code></diV>
    <div ng-show="workflow.externalId">External id: <code>{{workflow.externalId}}</code></diV>
    <div class="svg-container">
      <svg id="workflowSvg"/>
    </div>
  </div>
  <div class="col-md-6">
    <tabset>
      <tab heading="Action history">
        <table id="action-history" class="table table-striped table-hover">
          <thead>
            <th>No</th>
            <th>State</th>
            <th>Description</th>
            <th>Retries</th>
            <th>Started</th>
            <th>Finished</th>
            <th>Duration</th>
          </thead>
          <tbody>
            <tr ng-repeat="action in workflow.actions | reverse" >
              <td>{{workflow.actions.length - $index}}</td>
              <td ng-click="selectAction(action)">{{action.state}}</td>
              <td class="{{getClass(action)}}" ng-click="selectAction(action)">{{action.stateText}}</td>
              <td>{{action.retryNo}}</td>
              <td>{{action.executionStartTime | date:'medium'}}</td>
              <td>{{action.executionEndTime | date:'medium'}}</td>
              <td>{{duration(action)}}</td>
            </tr>
          </tbody>
        </table>
      </tab>
      <tab heading="State variables" >
        <table class="table table-striped table-hover">
          <thead>
            <tr><th>Variable</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr ng-repeat="(key, value) in workflow.stateVariables">
              <td>{{key}}</td>
              <td><pre>{{value | prettyPrintJson}}</pre></td>
            </tr>
          </tbody>
        </table>
      </tab>
      <tab heading="Manage">
        <form class="form" role="form">
          <label for="nextState">Set state to</label>
          <select id="nextState" ng-model="manage.nextState" ng-options="state.name for state in definition.states" class="form-control">
            <option value="">-- Keep current state --</option>
          </select>
          <label for="duration">Next activation in</label>
          <input id="duration" type="number" ng-model="manage.duration" class="form-control"/>
          <select id="timeUnit" ng-model="manage.timeUnit" ng-options="timeUnit for timeUnit in manage.timeUnits" class="form-control">
          </select>

          <button class="btn btn-default" ng-click="updateWorkflow(manage)">Update workflow</button>
        </form>
      </tab>
    </tabset>
  </div>
</div>
